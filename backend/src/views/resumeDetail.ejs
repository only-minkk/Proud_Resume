<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proud Resumes</title>
    <link rel="stylesheet" href="/styles/main.css" />
    <style>
      .container {
        width: 1000px;
      }
      input {
        display: block;
      }
      #profileDiv input {
        background-color: rgba(255, 255, 255, 0);
        border: 1px solid rgba(0, 0, 0, 0);
        height: 25px;
        font-size: 20px;
        font-weight: 500;
      }
      hr {
        border: none;
        height: 1px;
        background-color: #20232a;
        margin-bottom: 50px;
      }
      .auto-height-textarea {
        width: 100%;
        font-size: 20px;
        font-weight: 500;
        background-color: rgba(255, 255, 255, 0);
        border: 1px solid rgba(0, 0, 0, 0);
        resize: none; /* ì‚¬ìš©ìê°€ í¬ê¸°ë¥¼ ì¡°ì ˆí•˜ì§€ ëª»í•˜ê²Œ í•¨ */
        overflow-y: hidden; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ë°”ë¥¼ ìˆ¨ê¹€ */
      }
      .careerContainer,
      .educationContainer {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .careerType,
      .educationType {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .periodContainer {
        width: fit-content;
        padding: 20px 0;
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .periodContainer input {
        font-size: 20px;
        width: 100px;
        height: fit-content;
        display: flex;
        background-color: rgba(255, 255, 255, 0);
        border: 1px solid rgba(0, 0, 0, 0);
        text-align: center;
      }
      .leftColumn {
        width: 10%;
        padding-top: 18px;
        font-size: 25px;
        font-weight: bolder;
      }
      .rightColumn {
        width: 90%;
      }
      button {
        cursor: pointer; /* ì†ê°€ë½ ëª¨ì–‘ ì»¤ì„œ ì ìš© */
      }
      button:hover {
        transition: 0.3s;
        font-weight: bolder;
        background-color: #61dafb; /* í˜¸ë²„ ì‹œ ìƒ‰ìƒ ë³€ê²½ */
        color: #ffffff;
      }
      #buttonDiv {
        align-content: center;
        margin: 20px auto; /* ê°€ìš´ë° ì •ë ¬ì„ ìœ„í•œ ë§ˆì§„ */
        text-align: center;
      }
    </style>
    <header>
      <h1>PR | Proud Resumes</h1>
      <nav>
        <ul id="nav-list">
          <li><a href="/">home</a></li>
          <li><a id="logout">logout</a></li>
        </ul>
      </nav>
    </header>
  </head>
  <body>
    <div class="container">
      <main
        style="
          background-color: rgba(255, 255, 255, 0.555);
          border-radius: 100px;
        "
      >
        <!-- ì œëª© ì˜ì—­ -->
        <div id="titleDiv">
          <input
            type="text"
            style="
              font-weight: bold;
              background-color: rgba(255, 255, 255, 0);
              border: 1px solid rgba(0, 0, 0, 0);
              margin: 30px 0px;
              height: 50px;
              font-size: 50px;
              font-weight: 1000;
            "
            maxlength="10"
            placeholder="ì´ë ¥ì„œ ì œëª©(í•„ìˆ˜)"
            name="title"
            value="<%= data[0].title %>"
          />
        </div>
        <hr />
        <!-- ê¸°ë³¸ ì •ë³´ ì˜ì—­ -->
        <div id="profileDiv">
          <input
            type="text"
            maxlength="10"
            placeholder="ì´ë¦„(í•„ìˆ˜)"
            name="name"
            value="ğŸ‘¤ <%= data[0].resume['name'] %>"
          />
          <input
            type="email"
            name="email"
            placeholder="email"
            value="ğŸ“§ <%= data[0].resume['email'] || '' %>"
          />
          <input
            type="tel"
            name="tel"
            placeholder="tel"
            value="ğŸ“ <%= data[0].resume['tel'] || '' %>"
          />
          <textarea
            id="introduceTextarea"
            class="auto-height-textarea"
            style="margin-top: 30px"
            name="introduce"
            placeholder="ìê¸°ì†Œê°œ"
          >
<%= data[0].resume['introduce'] || '' %> </textarea
          >
        </div>
        <hr />

        <!-- ì´ë ¥ ì˜ì—­ -->
        <div class="careerContainer">
          <div class="leftColumn">ê²½ë ¥</div>
          <div class="rightColumn">
            <ul>
              <%const career = data[0].resume['career'] || [{}]%> <%
              career.forEach((obj) => { %>
              <li style="margin-bottom: 40px">
                <div class="careerType">
                  <div>
                    <input
                      type="text"
                      style="
                        width: fit-content;
                        background-color: rgba(255, 255, 255, 0);
                        border: 1px solid rgba(0, 0, 0, 0);
                        font-size: 30px;
                        font-weight: bolder;
                      "
                      name="company"
                      placeholder="íšŒì‚¬ëª…"
                      value="<%= obj['company'] %>"
                    />
                    <input
                      type="text"
                      style="
                        width: fit-content;
                        background-color: rgba(255, 255, 255, 0);
                        border: 1px solid rgba(0, 0, 0, 0);
                        margin-left: 15px;
                        font-size: 20px;
                        font-weight: bolder;
                      "
                      name="position"
                      placeholder="ë¶€ì„œëª…/ì§ì±…"
                      value="<%= obj['position'] %>"
                    />
                  </div>
                  <div class="periodContainer">
                    <input
                      type="text"
                      name="startDate"
                      placeholder="(ì‹œì‘ì¼)"
                      value="<%= obj['startDate'] %>"
                    />
                    <span style="margin: 0 20px 12px 20px; font-size: 20px"
                      >-</span
                    >
                    <input
                      type="text"
                      name="endDate"
                      placeholder="(ì¢…ë£Œì¼)"
                      value="<%= obj['endDate'] %>"
                    />
                  </div>
                </div>
                <textarea
                  id="achievementsTextarea"
                  class="auto-height-textarea"
                  style="margin-top: 30px; font-weight: bolder"
                  type="text"
                  name="achievements"
                  placeholder="ì£¼ìš”ì„±ê³¼"
                >
<%= obj['achievements'] || '' %></textarea
                >
                <hr />
              </li>
              <% }) %>
            </ul>
          </div>
        </div>
        <!-- í•™ë ¥ ì˜ì—­ -->
        <div class="educationContainer">
          <div class="leftColumn">í•™ë ¥</div>
          <div class="rightColumn">
            <ul>
              <% const education = data[0].resume['education'] || [{}]; %> <%
              education.forEach((obj) => { %>
              <li style="margin-bottom: 40px">
                <div class="educationType">
                  <div>
                    <input
                      type="text"
                      style="
                        width: fit-content;
                        background-color: rgba(255, 255, 255, 0);
                        border: 1px solid rgba(0, 0, 0, 0);
                        font-size: 30px;
                        font-weight: bolder;
                      "
                      name="school"
                      placeholder="í•™êµëª…"
                      value="<%= obj['school'] || ''  %>"
                    />
                    <input
                      type="text"
                      style="
                        width: fit-content;
                        background-color: rgba(255, 255, 255, 0);
                        border: 1px solid rgba(0, 0, 0, 0);
                        margin-left: 15px;
                        font-size: 20px;
                        font-weight: bolder;
                      "
                      name="majorAndDegrees"
                      placeholder="ì „ê³µ ë° í•™ìœ„"
                      value="<%= obj['majorAndDegrees'] %>"
                    />
                  </div>
                  <div class="periodContainer">
                    <input
                      type="text"
                      name="startDate"
                      placeholder="(ì‹œì‘ì¼)"
                      value="<%= obj['startDate'] %>"
                    />
                    <span style="margin: 0 20px 12px 20px; font-size: 20px"
                      >-</span
                    >
                    <input
                      type="text"
                      name="endDate"
                      placeholder="(ì¢…ë£Œì¼)"
                      value="<%= obj['endDate'] %>"
                    />
                  </div>
                </div>
                <textarea
                  id="achievementsTextarea"
                  class="auto-height-textarea"
                  style="margin-top: 30px; font-weight: bolder"
                  type="text"
                  name="CompletedCoursesAndResearch"
                  placeholder="ì´ìˆ˜ê³¼ëª© ë° ì—°êµ¬ë‚´ìš©"
                >
<%= obj['CompletedCoursesAndResearch'] || '' %></textarea
                >
                <hr />
              </li>
              <% }) %>
            </ul>
          </div>
        </div>
        <div id="buttonDiv">
          <button id="submitButton" type="submit">ì œì¶œ</button>
          <button type="button" onclick="cancelButton(event)">ì·¨ì†Œ</button>
        </div>
      </main>
    </div>
  </body>

  <script src="../components/activity-timeout-logout.js"></script>
  <script>
    // ìë™ ë†’ì´ ì¡°ì ˆ í•¨ìˆ˜
    function adjustTextareaHeight(textarea) {
      textarea.style.height = "auto"; // ë†’ì´ë¥¼ ì´ˆê¸°í™”í•˜ì—¬ í…ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ í‘œì‹œí•  ìˆ˜ ìˆê²Œ í•¨
      textarea.style.height = textarea.scrollHeight + "px"; // ì‹¤ì œ í…ìŠ¤íŠ¸ì˜ ë†’ì´ë¡œ ì„¤ì •
    }

    document.addEventListener("DOMContentLoaded", () => {
      const introduceTextarea = document.getElementById("introduceTextarea");
      const achievementsTextarea = document.getElementById(
        "achievementsTextarea"
      );
      adjustTextareaHeight(introduceTextarea); // ì´ˆê¸°ì— í•œ ë²ˆ ë†’ì´ ì¡°ì ˆ
      adjustTextareaHeight(achievementsTextarea); // ì´ˆê¸°ì— í•œ ë²ˆ ë†’ì´ ì¡°ì ˆ

      // í…ìŠ¤íŠ¸ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë†’ì´ ë‹¤ì‹œ ì¡°ì ˆ
      introduceTextarea.addEventListener("input", function () {
        adjustTextareaHeight(introduceTextarea);
      });
      achievementsTextarea.addEventListener("input", function () {
        adjustTextareaHeight(achievementsTextarea);
      });

      // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
      const logoutButton = document.getElementById("logout");

      // ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      logoutButton.addEventListener("click", async (event) => {
        try {
          // ê¸°ë³¸ ë™ì‘ ë°©ì§€
          event.preventDefault();

          const response = await fetch(`/users/${localStorage.userId}/logout`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${localStorage.accessToken}`,
            },
          });

          if (response.ok) {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¹„ìš°ê¸°
            localStorage.clear();
            alert("ë¡œê·¸ì•„ì›ƒí•˜ì˜€ìŠµë‹ˆë‹¤.");
            window.location = "/";
            return;
          } else {
            const error = await response.json();
            if (error.message.includes("ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")) {
              // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¹„ìš°ê¸°
              localStorage.clear();
              alert("ë¡œê·¸ì•„ì›ƒí•˜ì˜€ìŠµë‹ˆë‹¤.");
              window.location = "/";
              return;
            }
            throw error;
          }
        } catch (error) {
          alert(error.message);
          window.location.href = "/users";
        }
      });
    });
  </script>
</html>
