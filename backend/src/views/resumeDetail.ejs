<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proud Resumes</title>
    <link rel="stylesheet" href="/styles/main.css" />
    <style>
      .container {
        width: 1000px;
      }
      input {
        display: block;
      }
      #profileDiv input {
        background-color: rgba(255, 255, 255, 0);
        border: 1px solid rgba(0, 0, 0, 0);
        height: 25px;
        font-size: 20px;
        font-weight: 500;
      }
      hr {
        border: none;
        height: 1px;
        background-color: #20232a;
        margin-bottom: 50px;
      }
      .auto-height-textarea {
        width: 100%;
        font-size: 20px;
        font-weight: 500;
        background-color: rgba(255, 255, 255, 0);
        border: 1px solid rgba(0, 0, 0, 0);
        resize: none; /* ÏÇ¨Ïö©ÏûêÍ∞Ä ÌÅ¨Í∏∞Î•º Ï°∞Ï†àÌïòÏßÄ Î™ªÌïòÍ≤å Ìï® */
        overflow-y: hidden; /* ÏÑ∏Î°ú Ïä§ÌÅ¨Î°§Î∞îÎ•º Ïà®ÍπÄ */
      }
      .careerContainer,
      .educationContainer {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .careerType,
      .educationType {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .periodContainer {
        width: fit-content;
        padding: 20px 0;
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .periodContainer input {
        font-size: 20px;
        width: 100px;
        height: fit-content;
        display: flex;
        background-color: rgba(255, 255, 255, 0);
        border: 1px solid rgba(0, 0, 0, 0);
        text-align: center;
      }
      .leftColumn {
        width: 10%;
        padding-top: 18px;
        font-size: 25px;
        font-weight: bolder;
      }
      .rightColumn {
        width: 90%;
      }
      button {
        cursor: pointer; /* ÏÜêÍ∞ÄÎùΩ Î™®Ïñë Ïª§ÏÑú Ï†ÅÏö© */
      }
      button:hover {
        transition: 0.3s;
        font-weight: bolder;
        background-color: #61dafb; /* Ìò∏Î≤Ñ Ïãú ÏÉâÏÉÅ Î≥ÄÍ≤Ω */
        color: #ffffff;
      }
      #buttonDiv {
        align-content: center;
        margin: 20px auto; /* Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨ÏùÑ ÏúÑÌïú ÎßàÏßÑ */
        text-align: center;
      }
    </style>
    <header>
      <h1>PR | Proud Resumes</h1>
      <nav>
        <ul id="nav-list">
          <li><a href="/">home</a></li>
          <li><a id="logout">logout</a></li>
        </ul>
      </nav>
    </header>
  </head>
  <body>
    <div class="container">
      <main
        style="
          background-color: rgba(255, 255, 255, 0.555);
          border-radius: 100px;
        "
      >
        <!-- Ï†úÎ™© ÏòÅÏó≠ -->
        <div id="titleDiv">
          <input
            type="text"
            style="
              font-weight: bold;
              background-color: rgba(255, 255, 255, 0);
              border: 1px solid rgba(0, 0, 0, 0);
              margin: 30px 0px;
              height: 50px;
              font-size: 50px;
              font-weight: 1000;
            "
            maxlength="10"
            placeholder="Ïù¥Î†•ÏÑú Ï†úÎ™©(ÌïÑÏàò)"
            name="title"
            value="<%= data[0].title %>"
          />
        </div>
        <hr />
        <!-- Í∏∞Î≥∏ Ï†ïÎ≥¥ ÏòÅÏó≠ -->
        <div id="profileDiv">
          <input
            type="text"
            maxlength="10"
            placeholder="Ïù¥Î¶Ñ(ÌïÑÏàò)"
            name="name"
            value="üë§ <%= data[0].resume['name'] %>"
          />
          <input
            type="email"
            name="email"
            placeholder="email"
            value="üìß <%= data[0].resume['email'] || '' %>"
          />
          <input
            type="tel"
            name="tel"
            placeholder="tel"
            value="üìû <%= data[0].resume['tel'] || '' %>"
          />
          <textarea
            id="introduceTextarea"
            class="auto-height-textarea"
            style="margin-top: 30px"
            name="introduce"
            placeholder="ÏûêÍ∏∞ÏÜåÍ∞ú"
          >
<%= data[0].resume['introduce'] || '' %> </textarea
          >
        </div>
        <hr />

        <!-- Ïù¥Î†• ÏòÅÏó≠ -->
        <div class="careerContainer">
          <div class="leftColumn">Í≤ΩÎ†•</div>
          <div class="rightColumn">
            <ul>
              <%const career = data[0].resume['career'] || [{}]%> <%
              career.forEach((obj) => { %>
              <li style="margin-bottom: 40px">
                <div class="careerType">
                  <div>
                    <input
                      type="text"
                      style="
                        width: fit-content;
                        background-color: rgba(255, 255, 255, 0);
                        border: 1px solid rgba(0, 0, 0, 0);
                        font-size: 30px;
                        font-weight: bolder;
                      "
                      name="company"
                      placeholder="ÌöåÏÇ¨Î™Ö"
                      value="<%= obj['company'] %>"
                    />
                    <input
                      type="text"
                      style="
                        width: fit-content;
                        background-color: rgba(255, 255, 255, 0);
                        border: 1px solid rgba(0, 0, 0, 0);
                        margin-left: 15px;
                        font-size: 20px;
                        font-weight: bolder;
                      "
                      name="position"
                      placeholder="Î∂ÄÏÑúÎ™Ö/ÏßÅÏ±Ö"
                      value="<%= obj['position'] %>"
                    />
                  </div>
                  <div class="periodContainer">
                    <input
                      type="text"
                      name="startDate"
                      placeholder="(ÏãúÏûëÏùº)"
                      value="<%= obj['startDate'] %>"
                    />
                    <span style="margin: 0 20px 12px 20px; font-size: 20px"
                      >-</span
                    >
                    <input
                      type="text"
                      name="endDate"
                      placeholder="(Ï¢ÖÎ£åÏùº)"
                      value="<%= obj['endDate'] %>"
                    />
                  </div>
                </div>
                <textarea
                  id="achievementsTextarea"
                  class="auto-height-textarea"
                  style="margin-top: 30px; font-weight: bolder"
                  type="text"
                  name="achievements"
                  placeholder="Ï£ºÏöîÏÑ±Í≥º"
                >
<%= obj['achievements'] || '' %></textarea
                >
                <hr />
              </li>
              <% }) %>
            </ul>
          </div>
        </div>
        <!-- ÌïôÎ†• ÏòÅÏó≠ -->
        <div class="educationContainer">
          <div class="leftColumn">ÌïôÎ†•</div>
          <div class="rightColumn">
            <ul>
              <% const education = data[0].resume['education'] || [{}]; %> <%
              education.forEach((obj) => { %>
              <li style="margin-bottom: 40px">
                <div class="educationType">
                  <div>
                    <input
                      type="text"
                      style="
                        width: fit-content;
                        background-color: rgba(255, 255, 255, 0);
                        border: 1px solid rgba(0, 0, 0, 0);
                        font-size: 30px;
                        font-weight: bolder;
                      "
                      name="school"
                      placeholder="ÌïôÍµêÎ™Ö"
                      value="<%= obj['school'] || ''  %>"
                    />
                    <input
                      type="text"
                      style="
                        width: fit-content;
                        background-color: rgba(255, 255, 255, 0);
                        border: 1px solid rgba(0, 0, 0, 0);
                        margin-left: 15px;
                        font-size: 20px;
                        font-weight: bolder;
                      "
                      name="majorAndDegrees"
                      placeholder="Ï†ÑÍ≥µ Î∞è ÌïôÏúÑ"
                      value="<%= obj['majorAndDegrees'] %>"
                    />
                  </div>
                  <div class="periodContainer">
                    <input
                      type="text"
                      name="startDate"
                      placeholder="(ÏãúÏûëÏùº)"
                      value="<%= obj['startDate'] %>"
                    />
                    <span style="margin: 0 20px 12px 20px; font-size: 20px"
                      >-</span
                    >
                    <input
                      type="text"
                      name="endDate"
                      placeholder="(Ï¢ÖÎ£åÏùº)"
                      value="<%= obj['endDate'] %>"
                    />
                  </div>
                </div>
                <textarea
                  id="achievementsTextarea"
                  class="auto-height-textarea"
                  style="margin-top: 30px; font-weight: bolder"
                  type="text"
                  name="CompletedCoursesAndResearch"
                  placeholder="Ïù¥ÏàòÍ≥ºÎ™© Î∞è Ïó∞Íµ¨ÎÇ¥Ïö©"
                >
<%= obj['CompletedCoursesAndResearch'] || '' %></textarea
                >
                <hr />
              </li>
              <% }) %>
            </ul>
          </div>
        </div>
        <div id="buttonDiv">
          <button id="submitButton" type="submit">Ï†úÏ∂ú</button>
          <button type="button" onclick="cancelButton(event)">Ï∑®ÏÜå</button>
        </div>
      </main>
    </div>
  </body>

  <script src="../components/activity-timeout-logout.js"></script>
  <script>
    // ÏûêÎèô ÎÜíÏù¥ Ï°∞Ï†à Ìï®Ïàò
    function adjustTextareaHeight(textarea) {
      textarea.style.height = "auto"; // ÎÜíÏù¥Î•º Ï¥àÍ∏∞ÌôîÌïòÏó¨ ÌÖçÏä§Ìä∏Î•º Î™®Îëê ÌëúÏãúÌï† Ïàò ÏûàÍ≤å Ìï®
      textarea.style.height = textarea.scrollHeight + "px"; // Ïã§Ï†ú ÌÖçÏä§Ìä∏Ïùò ÎÜíÏù¥Î°ú ÏÑ§Ï†ï
    }

    document.addEventListener("DOMContentLoaded", () => {
      const introduceTextarea = document.getElementById("introduceTextarea");
      const achievementsTextarea = document.getElementById(
        "achievementsTextarea"
      );
      adjustTextareaHeight(introduceTextarea); // Ï¥àÍ∏∞Ïóê Ìïú Î≤à ÎÜíÏù¥ Ï°∞Ï†à
      adjustTextareaHeight(achievementsTextarea); // Ï¥àÍ∏∞Ïóê Ìïú Î≤à ÎÜíÏù¥ Ï°∞Ï†à

      // ÌÖçÏä§Ìä∏Í∞Ä Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ ÎÜíÏù¥ Îã§Ïãú Ï°∞Ï†à
      introduceTextarea.addEventListener("input", function () {
        adjustTextareaHeight(introduceTextarea);
      });
      achievementsTextarea.addEventListener("input", function () {
        adjustTextareaHeight(achievementsTextarea);
      });

      // Î°úÍ∑∏ÏïÑÏõÉ Î≤ÑÌäº
      const logoutButton = document.getElementById("logout");

      // Î°úÍ∑∏ÏïÑÏõÉ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
      logoutButton.addEventListener("click", async (event) => {
        try {
          // Í∏∞Î≥∏ ÎèôÏûë Î∞©ÏßÄ
          event.preventDefault();

          const response = await fetch(`/users/${localStorage.userId}/logout`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${localStorage.accessToken}`,
            },
          });

          if (response.ok) {
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÎπÑÏö∞Í∏∞
            localStorage.clear();
            alert("Î°úÍ∑∏ÏïÑÏõÉÌïòÏòÄÏäµÎãàÎã§.");
            window.location = "/";
            return;
          } else {
            const error = await response.json();
            if (error.message.includes("ÏÑ∏ÏÖòÏù¥ ÎßåÎ£åÎêòÏóàÏäµÎãàÎã§.")) {
              // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÎπÑÏö∞Í∏∞
              localStorage.clear();
              alert("Î°úÍ∑∏ÏïÑÏõÉÌïòÏòÄÏäµÎãàÎã§.");
              window.location = "/";
              return;
            }
            throw error;
          }
        } catch (error) {
          alert(error.message);
          window.location.href = "/users";
        }
      });
    });
  </script>
</html>
